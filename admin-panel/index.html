<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zerda Admin Panel</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #18214F 0%, #283593 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            color: #18214F;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 16px;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .feature-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }
        
        .feature-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .feature-title {
            font-size: 18px;
            font-weight: 600;
            color: #18214F;
        }
        
        .feature-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ddd;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .toggle-switch.active {
            background: #18214F;
        }
        
        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }
        
        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .btn-primary {
            background: #18214F;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1a2555;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #18214F;
            border: 2px solid #18214F;
        }
        
        .btn-secondary:hover {
            background: #18214F;
            color: white;
        }
        
        .status {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
            margin-top: 20px;
        }
        
        .status.success {
            border-left: 4px solid #28a745;
        }
        
        .status.error {
            border-left: 4px solid #dc3545;
        }
        
        .json-output {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        
        .feature-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const AdminPanel = () => {
            const [features, setFeatures] = useState({
                dashboard: { enabled: true, title: "Ana Sayfa (Döviz)", description: "Ana döviz kurları ekranı", icon: "💰" },
                goldPrices: { enabled: true, title: "Altın Fiyatları", description: "Altın ve değerli metal fiyatları", icon: "🥇" },
                converter: { enabled: true, title: "Döviz Çevirici", description: "Para birimi çevirme aracı", icon: "🔄" },
                alarms: { enabled: true, title: "Alarm Sistemi", description: "Fiyat alarm ve bildirimleri", icon: "🔔" },
                portfolio: { enabled: true, title: "Portföy Yönetimi", description: "Kişisel portföy takibi", icon: "📊" },
                profile: { enabled: true, title: "Profil Ayarları", description: "Kullanıcı profil sayfası", icon: "👤" },
                watchlist: { enabled: true, title: "Takip Listem", description: "Favori döviz ve altın takibi", icon: "⭐" },
                profitLossCalculator: { enabled: true, title: "Kar/Zarar Hesaplama", description: "Yatırım kar/zarar hesaplayıcısı", icon: "🧮" },
                performanceHistory: { enabled: true, title: "Performans Geçmişi", description: "Yatırım performans analizi", icon: "📊" },
                sarrafiyeIscilik: { enabled: true, title: "Sarrafiye İşçilikleri", description: "Altın işçilik ücretleri", icon: "🔨" },
                gecmisKurlar: { enabled: true, title: "Geçmiş Kurlar", description: "Tarihsel döviz kurları", icon: "📅" }
            });

            const [status, setStatus] = useState(null);
            const [showJson, setShowJson] = useState(false);

            const toggleFeature = async (featureKey) => {
                const newEnabled = !features[featureKey].enabled;
                
                // Önce UI'ı güncelle (optimistic update)
                setFeatures(prev => ({
                    ...prev,
                    [featureKey]: {
                        ...prev[featureKey],
                        enabled: newEnabled
                    }
                }));

                // Hemen API'ye kaydet
                try {
                    const config = {
                        timestamp: new Date().toISOString(),
                        features: {
                            ...Object.keys(features).reduce((acc, key) => {
                                acc[key] = key === featureKey ? newEnabled : features[key].enabled;
                                return acc;
                            }, {})
                        }
                    };

                    const response = await fetch('http://localhost:3002/api/config', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(config),
                    });

                    if (response.ok) {
                        const result = await response.json();
                        setStatus({ 
                            type: 'success', 
                            message: `${features[featureKey].title} ${newEnabled ? 'açıldı' : 'kapatıldı'} ve kaydedildi!` 
                        });
                    } else {
                        throw new Error('API kaydetme hatası');
                    }
                } catch (error) {
                    // Hata durumunda UI'ı geri al
                    setFeatures(prev => ({
                        ...prev,
                        [featureKey]: {
                            ...prev[featureKey],
                            enabled: !newEnabled
                        }
                    }));
                    setStatus({ 
                        type: 'error', 
                        message: 'Ayar kaydedilemedi! UI geri alındı.' 
                    });
                }
            };

            const saveConfiguration = () => {
                try {
                    const config = {
                        timestamp: new Date().toISOString(),
                        features: Object.keys(features).reduce((acc, key) => {
                            acc[key] = features[key].enabled;
                            return acc;
                        }, {})
                    };

                    // Local storage'a kaydet
                    localStorage.setItem('zerdaConfig', JSON.stringify(config));
                    
                    // JSON dosyası oluştur ve indir
                    const blob = new Blob([JSON.stringify(config, null, 2)], { 
                        type: 'application/json' 
                    });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'zerda-config.json';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    setStatus({ type: 'success', message: 'Konfigürasyon başarıyla kaydedildi ve indirildi!' });
                } catch (error) {
                    setStatus({ type: 'error', message: 'Kaydetme sırasında hata oluştu!' });
                }
            };

            const loadConfiguration = async () => {
                try {
                    // API'den yükle
                    const response = await fetch('http://localhost:3002/api/config');
                    if (response.ok) {
                        const result = await response.json();
                        if (result.success && result.data.features) {
                            setFeatures(prev => {
                                const updated = { ...prev };
                                Object.keys(result.data.features).forEach(key => {
                                    if (updated[key]) {
                                        updated[key].enabled = result.data.features[key];
                                    }
                                });
                                return updated;
                            });
                            setStatus({ type: 'success', message: 'API\'den konfigürasyon yüklendi!' });
                            return;
                        }
                    }
                    
                    // API başarısız olursa localStorage'dan yükle
                    const saved = localStorage.getItem('zerdaConfig');
                    if (saved) {
                        const config = JSON.parse(saved);
                        setFeatures(prev => {
                            const updated = { ...prev };
                            Object.keys(config.features || {}).forEach(key => {
                                if (updated[key]) {
                                    updated[key].enabled = config.features[key];
                                }
                            });
                            return updated;
                        });
                        setStatus({ type: 'success', message: 'LocalStorage\'dan konfigürasyon yüklendi!' });
                    }
                } catch (error) {
                    setStatus({ type: 'error', message: 'Yükleme sırasında hata oluştu!' });
                }
            };

            const resetToDefaults = () => {
                setFeatures(prev => {
                    const reset = { ...prev };
                    Object.keys(reset).forEach(key => {
                        reset[key].enabled = true;
                    });
                    return reset;
                });
                setStatus({ type: 'success', message: 'Tüm özellikler varsayılan duruma getirildi!' });
            };

            useEffect(() => {
                loadConfiguration(); // Sayfa yüklendiğinde API'den config'i yükle
            }, []);

            useEffect(() => {
                if (status) {
                    const timer = setTimeout(() => setStatus(null), 3000);
                    return () => clearTimeout(timer);
                }
            }, [status]);

            const enabledCount = Object.values(features).filter(f => f.enabled).length;
            const totalCount = Object.keys(features).length;

            return (
                <div className="container">
                    <div className="header">
                        <h1>🏛️ Zerda Admin Panel</h1>
                        <p>Mobil uygulama özelliklerini yönetin • {enabledCount}/{totalCount} özellik aktif</p>
                    </div>

                    <div className="features-grid">
                        {Object.entries(features).map(([key, feature]) => (
                            <div key={key} className="feature-card">
                                <div className="feature-header">
                                    <div className="feature-title">
                                        <span className="feature-icon">{feature.icon}</span>
                                        {feature.title}
                                    </div>
                                    <div 
                                        className={`toggle-switch ${feature.enabled ? 'active' : ''}`}
                                        onClick={() => toggleFeature(key)}
                                    >
                                        <div className="toggle-slider"></div>
                                    </div>
                                </div>
                                <div className="feature-description">
                                    {feature.description}
                                </div>
                                <div style={{ 
                                    fontSize: '12px', 
                                    color: feature.enabled ? '#28a745' : '#dc3545',
                                    fontWeight: '600'
                                }}>
                                    {feature.enabled ? '✅ AKTİF' : '❌ PASİF'}
                                </div>
                            </div>
                        ))}
                    </div>

                    <div className="actions">
                        <button className="btn btn-primary" onClick={saveConfiguration}>
                            💾 Kaydet & İndir
                        </button>
                        <button className="btn btn-secondary" onClick={loadConfiguration}>
                            📥 Yükle
                        </button>
                        <button className="btn btn-secondary" onClick={resetToDefaults}>
                            🔄 Sıfırla
                        </button>
                        <button 
                            className="btn btn-secondary" 
                            onClick={() => setShowJson(!showJson)}
                        >
                            {showJson ? '📋 JSON Gizle' : '📋 JSON Göster'}
                        </button>
                    </div>

                    {status && (
                        <div className={`status ${status.type}`}>
                            {status.message}
                        </div>
                    )}

                    {showJson && (
                        <div className="json-output">
                            {JSON.stringify({
                                timestamp: new Date().toISOString(),
                                features: Object.keys(features).reduce((acc, key) => {
                                    acc[key] = features[key].enabled;
                                    return acc;
                                }, {})
                            }, null, 2)}
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<AdminPanel />, document.getElementById('root'));
    </script>
</body>
</html>